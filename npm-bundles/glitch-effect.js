import{useState as t,useCallback as e}from"react";var n=Object.defineProperty,i=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,e,i)=>e in t?n(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,c=(t,e)=>{for(var n in e||(e={}))o.call(e,n)&&s(t,n,e[n]);if(a)for(var n of a(e))l.call(e,n)&&s(t,n,e[n]);return t},h=(t,e)=>i(t,r(e));const m=(t="always")=>({playMode:t,optimizeSeo:!0,createContainers:!0,hideOverflow:!1,timing:"always"===t?{duration:2e3,iterations:1/0}:{duration:250,iterations:1},glitchTimeSpan:"always"===t?{start:.5,end:.7}:{start:0,end:1},shake:{velocity:15,amplitudeX:.2,amplitudeY:.2},slice:"click"===t?{count:15,velocity:20,minHeight:.02,maxHeight:.15,hueRotate:!0}:{count:6,velocity:15,minHeight:.02,maxHeight:.15,hueRotate:!0},pulse:!1}),p=(t,e)=>{if(!t.glitchTimeSpan)return 1;const n=t.glitchTimeSpan.start,i=t.glitchTimeSpan.end;if(e<n||e>i)return 0;const r=n+(i-n)/2;return e<r?(e-n)/(r-n):(i-e)/(i-r)},d=(t,e)=>2*(Math.random()-.5)*p(t,e),u=({minHeight:t,maxHeight:e,minWidth:n,maxWidth:i})=>{const r=Math.floor(Math.random()*(100*(e-t)+1))+100*t,a=Math.floor(Math.random()*(100*(i-n)+1))+100*n,o=Math.floor(Math.random()*(100-r)),l=Math.floor(Math.random()*(100-a));return`polygon(${`${l+a}% ${o}%`},${`${l+a}% ${o+r}%`},${`${l}% ${o+r}%`},${`${l}% ${o}%`})`},g=t=>t.pulse?{steps:[{transform:"scale(1)",opacity:"1"},{transform:`scale(${t.pulse.scale})`,opacity:"0"}],timing:h(c({},t.timing),{delay:(t.glitchTimeSpan?t.glitchTimeSpan.start:0)*t.timing.duration,easing:"ease-in-out"})}:null,f=t=>{if(!t.shake)return{steps:[],timing:{}};const e=Math.floor(t.shake.velocity*t.timing.duration/1e3)+1,n=[];for(let i=0;i<e;++i){const r=d(t,i/e)*t.shake.amplitudeX*100,a=d(t,i/e)*t.shake.amplitudeY*100;n.push({transform:`translate3d(${r}%,${a}%,0)`})}return{steps:n,timing:c({easing:`steps(${e},jump-start)`},t.timing)}},y=t=>[f(t),g(t),...Array.from({length:t.slice.count}).map((()=>(t=>{const e=Math.floor(t.slice.velocity*t.timing.duration/1e3)+1,n=[];for(let i=0;i<e;++i){if(0===p(t,i/e)){n.push({opacity:"0",transform:"none",clipPath:"unset"});continue}const r={opacity:"1",transform:`translate3d(${30*d(t,i/e)}%,0,0)`,clipPath:u({minHeight:t.slice.minHeight,maxHeight:t.slice.maxHeight,minWidth:1,maxWidth:1})};t.slice.hueRotate&&(r.filter=`hue-rotate(${Math.floor(360*d(t,i/e))}deg)`),n.push(r)}return{steps:n,timing:c({easing:`steps(${e},jump-start)`},t.timing)}})(t)))].filter((t=>null!==t)),v=(...t)=>{const e=t=>t&&"object"==typeof t;return t.reduce(((t,n)=>(Object.keys(n).forEach((i=>{e(t[i])&&e(n[i])?t[i]=v(t[i],n[i]):void 0!==n[i]&&(t[i]=n[i])})),t)),{})},b=(t,e,n)=>{const{glitched:i,container:r,layersContainer:a}=((t,e)=>{var n,i;if(!e.createContainers)return{container:t,layersContainer:t,glitched:t.firstElementChild};if(!t.dataset.glitched){const e=document.createElement("div"),i=document.createElement("div");return getComputedStyle(t).getPropertyValue("display").match(/^inline/)&&(i.style.display="inline-block"),i.appendChild(e),null==(n=t.parentElement)||n.insertBefore(i,t),e.prepend(t),{container:i,layersContainer:e,glitched:t}}const r=t.parentElement,a=null==(i=t.parentElement)?void 0:i.parentElement;for(;r.children.length>1;)r.removeChild(r.children[1]);return r.firstElementChild.getAnimations().forEach((t=>t.cancel())),{container:a,layersContainer:r,glitched:t}})(t,n);a.style.display="grid",n.hideOverflow&&(r.style.overflow="hidden"),n.html&&(i.innerHTML=n.html),i.style.gridArea="1/1/-1/-1";const o=i.cloneNode(!0);o.dataset.islayer="true",o.style.gridArea="1/1/-1/-1",o.style.userSelect="none",o.style.pointerEvents="none",o.style.opacity="0";for(let t=0;t<e.length-1;++t){const t=o.cloneNode(!0);a.appendChild(t)}const l=()=>{e.forEach(((t,e)=>{a.children[e].animate(t.steps,t.timing)}))},s=()=>{e.forEach(((t,e)=>{a.children[e].getAnimations().forEach((t=>{t.cancel()}))}))};switch(r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,n.playMode){case"always":l();break;case"hover":r.onmouseenter=l,r.onmouseleave=s;break;case"click":r.onclick=()=>{s(),l()}}return t.dataset.glitched="1",{container:r,startGlitch:l,stopGlitch:s}},$=(t=".powerglitch",e={})=>{const n=v(m(e.playMode),e);if(n.optimizeSeo&&/google|bing|baidu|yandex|slurp|bot/i.exec(navigator.userAgent))return{containers:[],startGlitch:()=>{},stopGlitch:()=>{}};let i=[];"string"==typeof t?i=Array.from(document.querySelectorAll(t)):t instanceof NodeList?i=Array.from(t):Array.isArray(t)?i=t:t instanceof HTMLElement&&(i=[t]);const r=y(n),a=i.filter((t=>!t.dataset.islayer)).map((t=>b(t,r,n)));return{containers:a.map((t=>t.container)),startGlitch:()=>a.forEach((t=>t.startGlitch())),stopGlitch:()=>a.forEach((t=>t.stopGlitch()))}};function E(n){const[i,r]=t(n),[a,o]=t((()=>()=>{})),[l,s]=t((()=>()=>{}));return{ref:e((t=>{if(!t)return;const e=$(t,i);o((()=>e.startGlitch)),s((()=>e.stopGlitch))}),[i]),startGlitch:a,stopGlitch:l,setOptions:r}}export{E as useGlitch};
